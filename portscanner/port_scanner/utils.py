import subprocess


# Function to perform service detection
def detect_service(port):
    # Dictionary mapping common ports
    common_ports = {
        1: "TCPMUX",
        5: "Remote Job Entry",
        7: "Echo",
        9: "Discard",
        11: "SYSTAT",
        13: "Daytime",
        17: "Quote of the Day",
        18: "Message Send Protocol",
        19: "Character Generator",
        20: "FTP Data",
        21: "FTP Control",
        22: "SSH",
        23: "Telnet",
        25: "SMTP",
        26: "RSFTP",
        37: "Time",
        42: "Host Name Server",
        43: "WHOIS",
        49: "Login Host Protocol",
        53: "DNS",
        63: "WHOIS++",
        67: "BOOTP Server",
        68: "BOOTP Client",
        69: "TFTP",
        70: "Gopher",
        79: "Finger",
        80: "HTTP",
        88: "Kerberos",
        109: "POP2",
        110: "POP3",
        113: "Ident",
        119: "NNTP",
        123: "NTP",
        137: "NetBIOS Name Service",
        138: "NetBIOS Datagram Service",
        139: "NetBIOS Session Service",
        143: "IMAP",
        161: "SNMP",
        179: "BGP",
        194: "IRC",
        201: "AppleTalk Routing Maintenance",
        389: "LDAP",
        443: "HTTPS",
        444: "SNPP",
        445: "Microsoft-DS",
        464: "Kerberos kpasswd",
        497: "Dantz Retrospect",
        500: "ISAKMP",
        512: "Remote Execution",
        513: "Login",
        514: "Shell",
        515: "Line Printer Spooler",
        520: "RIP",
        524: "NCP",
        530: "RPC",
        540: "UUCP",
        554: "RTSP",
        546: "DHCP Client",
        547: "DHCP Server",
        560: "RMONITOR",
        563: "NNTPS",
        587: "Submission",
        593: "HTTP RPC Ep Map",
        631: "IPP",
        636: "LDAPS",
        639: "MSDP",
        646: "LDP",
        691: "MS Exchange Routing",
        705: "AgentX",
        711: "TDP",
        720: "RDP",
        749: "Kerberos Admin",
        750: "Kerberos Version IV",
        765: "webster",
        777: "Multiling HTTP",
        783: "SpamAssassin",
        808: "CCProxy-HTTP",
        843: "Adobe Flash",
        873: "rsync",
        902: "VMware Server",
        992: "Telnet over SSL",
        993: "IMAPS",
        995: "POP3S",
        1008: "UFS Mount",
        1010: "Surf",
        1021: "RFC3692-style Experiment 1",
        1022: "RFC3692-style Experiment 2",
        1023: "Reserved",
        1024: "Reserved",
        1025: "Network Blackjack",
        1026: "Calendar Access Protocol",
        1027: "ICQ",
        1029: "DAMeware",
        1041: "AK2 Product",
        1048: "Sun's NEO Object Request Broker",
        1049: "Tobit David Postman VPMN",
        1050: "CORBA Management Agent",
        1053: "Remote Assistant (RA)",
        1054: "Bridgeway License Manager",
        1056: "VFO",
        1058: "nim",
        1059: "nimreg",
        1067: "Installation Bootstrap Proto. Serv.",
        1068: "Installation Bootstrap Proto. Cli.",
        1069: "COGNEX-INSIGHT",
        1080: "Socks",
        1094: "ROOTD",
        1096: "Common Name Resolution Protocol",
        1109: "Kerberos POP",
        1110: "Cluster status info",
        1111: "LM Social Server",
        1112: "Intelligent Communication Protocol",
        1121: "Datalode RMPP",
        1155: "Network File Access",
        1178: "SKK (kanji input)",
        1198: "The cajo project",
        1199: "DMIDI",
        1200: "SCOL",
        1201: "Nucleus Sand Database Server",
        1234: "Infoseek Search Agent",
        1241: "nessus",
        1311: "Dell OpenManage System Administrator",
        1313: "BMC_PATROLDB",
        1335: "Digital Notary Protocol",
        1344: "Internet Content Adaptation Protocol",
        1352: "Lotus Notes",
        1387: "cadsi-lm",
        1419: "Timbuktu Service 1 Port",
        1433: "SQL Server",
        1434: "SQL Server Monitor",
        1477: "ms-sna-server",
        1484: "Confluent License Manager",
        1500: "VLSI License Manager",
        1512: "Microsoft's Windows Internet Name Service",
        1521: "Oracle SQL",
        1524: "ingreslock",
        1525: "Prospero Directory Service non-priv",
        1527: "oracle",
        1529: "Support for Distributed File System (DFS)",
        1533: "IBM Sametime Virtual Places Chat",
        1547: "Laplink",
        1556: "VERITAS Private Branch Exchange",
        1580: "tn-tl-r1",
        1583: "simbaexpress",
        1589: "VQP",
        1594: "sixtrak",
        1600: "issd",
        1629: "Jacquard Protocol over PacketCable",
        1641: "InVision",
        1658: "sixnetudr",
        1666: "Perforce",
        1687: "nsjtp-ctrl",
        1700: "mps-raft",
        1711: "pptconference",
        1717: "fj-hdnet",
        1720: "H.323 Call Signalling",
        1723: "PPTP",
        1755: "MS NetMeeting",
        1761: "cft-0",
        1782: "hp-hcip",
        1783: "Port for RADIUS accounting protocol",
        1801: "Microsoft Message Queuing",
        1812: "RADIUS",
        1813: "RADIUS Accounting",
        1863: "MSNP (Microsoft Network Protocol)",
        1900: "Microsoft SSDP Enables discovery of UPnP devices",
        1911: "Starlight Networks Multimedia Transport Protocol",
        1935: "Macromedia Flash Communications Server MX",
        1947: "SentinelSRM",
        1971: "NetOp Remote Control",
        1972: "Cache",
        1973: "DLSw (Data Link Switching)",
        1985: "Cisco's HSRP (Hot Standby Router Protocol)",
        1986: "Cisco's HSRP (Hot Standby Router Protocol)",
        1987: "Cisco's HSRP (Hot Standby Router Protocol)",
        1988: "Cisco's HSRP (Hot Standby Router Protocol)",
        1989: "MHSnet system",
        1990: "cisco STUN Priority 1 port",
        1991: "cisco STUN Priority 2 port",
        1992: "cisco STUN Priority 3 port",
        1993: "cisco SNMP TCP port",
        1994: "cisco serial tunnel port",
        1995: "cisco perf port",
        1996: "cisco Remote SRB port",
        1997: "cisco Gateway Discovery Protocol",
        1998: "cisco X.25 service (XOT)",
        1999: "cisco identification port",
        2000: "Cisco SCCP (Skinny)",
        2001: "dc",
        2002: "globe",
        2003: "GNU finger",
        2004: "mailbox",
        2005: "berknet",
        2006: "invokator",
        2007: "dece",
        2008: "conf",
        2009: "news",
        2010: "search",
        2011: "raid",
        2012: "bootserver",
        2013: "raid-am",
        2014: "troff",
        2015: "cypress",
        2016: "bootclient",
        2017: "cypress-stat",
        2018: "terminus",
        2019: "about",
        2020: "xinupageserver",
        2021: "xinuexpansion1",
        2022: "xinuexpansion2",
        2023: "xinuexpansion3",
        2024: "xinuexpansion4",
        2025: "ellpack",
        2026: "scrabble",
        2027: "shadowserver",
        2028: "submitserver",
        2029: "hsrpv6",
        2030: "device2",
        2031: "mobrien-chat",
        2032: "blackboard",
        2033: "glogger",
        2034: "scoremgr",
        2035: "imsldoc",
        2036: "applus",
        2037: "wipro-wbserver",
        2038: "objectmanager",
        2039: "prizma",
        2040: "lam",
        2041: "interbase",
        2042: "isis",
        2043: "isis-bcast",
        2044: "rimsl",
        2045: "cdfunc",
        2046: "sdfunc",
        2047: "dls",
        2048: "dls-monitor",
        2049: "NFS",
        2050: "Avaya Aura Messaging Web Access",
        2051: "EPNSDP",
        2052: "clearvisn",
        2053: "Lot105 DTS",
        2054: "Weblogin",
        2055: "Iliad-Odyssey Protocol",
        2056: "OmniSky",
        2057: "Rich Content Protocol",
        2058: "NewWaveSearchables RMI",
        2059: "BMC Messaging Service",
        2060: "Telenium Daemon IF",
        2061: "NetMount",
        2062: "ICG SWP Port",
        2063: "ICG Bridge Port",
        2064: "ICG IP Relay Port",
        2065: "Data Link Switch Read Port Number",
        2066: "Avocent AuthSrv Protocol",
        2067: "Avocent CAC Port",
        2068: "Avocent DS Authorization",
        2069: "HTTP Event Port",
        2070: "AH and ESP Encapsulated in UDP packet",
        2071: "Axon Control Protocol",
        2072: "Axon Control Protocol",
        2073: "DataReel Database Socket",
        2074: "Vertel VMF SA",
        2075: "Newlix ServerWare Engine",
        2076: "Newlix JSPConfig",
        2077: "Old Tivoli Storage Manager",
        2078: "TPS Command Port",
        2079: "Idware Router Port",
        2080: "Autodesk NLM (FLEXlm)",
        2081: "KME PRINTER TRAP PORT",
        2082: "Infowave Mobility Server",
        2083: "Secure Radius Service",
        2084: "SunCluster Geographic",
        2085: "ADA Control",
        2086: "GNUnet",
        2087: "WebHost Manager (WHM)",
        2088: "WebHost Manager (WHM)",
        2089: "cpANEL",
        2090: "cpANEL",
        2091: "cpANEL",
        2092: "cpANEL",
        2093: "cpANEL",
        2094: "cpANEL",
        2095: "cpANEL",
        2096: "cpANEL",
        2097: "Jet Form Preview",
        2098: "Dialog Port",
        2099: "H.225 Annex G",
        2100: "AMINET",
        2101: "rtcm-sc104",
        2102: "Zephyr server",
        2103: "Zephyr serv-hm connection",
        2104: "Zephyr hostmanager",
        2105: "MiniPay",
        2106: "MZAP",
        2107: "BinTec Admin",
        2108: "Comcam",
        2109: "Ergolight",
        2110: "UMSP",
        2111: "DSATP",
        2112: "Idonix MetaNet",
        2113: "HSL StoRM",
        2114: "NEWHEIGHTS",
        2115: "Key Distribution Manager",
        2116: "CCOWCMR",
        2117: "MENTACLIENT",
        2118: "MENTASERVER",
        2119: "GSIGATEKEEPER",
        2120: "Quick Eagle Networks CP",
        2121: "SCIENTIA-SSDB",
        2122: "CauPC Remote Control",
        2123: "GTP-Control Plane (3GPP)",
        2124: "ELATELINK",
        2125: "LOCKSTEP",
        2126: "PktCable-COPS",
        2127: "INDEX-PC-WB",
        2128: "Net Steward Control",
        2129: "cs-live.com",
        2130: "XDS",
        2131: "Avantageb2b",
        2132: "AVAIL-EPMAP",
        2133: "ZYMED-ZPP",
        2134: "AVENUE",
        2135: "Grid Resource Information Server",
        2136: "APPWORXSRV",
        2137: "CONNECT",
        2138: "UNBIND-CLUSTER",
        2139: "IAS-AUTH",
        2140: "IAS-REG",
        2141: "IAS-ADMIND",
        2142: "IAS-REG",
        2143: "Live Vault Admin Event Notification",
        2144: "Live Vault Fast Object Transfer",
        2145: "Live Vault Remote Diagnostic Console Support",
        2146: "Live Vault Admin Event Notification",
        2147: "Live Vault Authentication",
        2148: "VERITAS UNIVERSAL COMMUNICATION LAYER",
        2149: "ACPTSYS",
        2150: "DYNAMIC3D",
        2151: "DOCENT",
        2152: "GTP-User Plane (3GPP)",
        2153: "Control Protocol",
        2154: "Standard Protocol",
        2155: "Bridge Protocol",
        2156: "TABU-LABEL",
        2157: "Xerox Network Document Scan Protocol",
        2158: "TouchNetPlus Service",
        2159: "GDB Remote Debug Port",
        2160: "APC 2160",
        2161: "APC 2161",
        2162: "Navisphere",
        2163: "Navisphere Secure",
        2164: "Dynamic DNS Version 3",
        2165: "X-Bone API",
        2166: "Mobile Messenger",
        2167: "Raw Async Serial Link",
        2168: "easy-soft Multiplexer",
        2169: "Voice Control Protocol",
        2170: "EyeTV Server Port",
        2171: "MS Firewall Storage",
        2172: "MS Firewall SecureStorage",
        2173: "MS Firewall Replication",
        2174: "MS Firewall Intra Array",
        2175: "Microsoft Desktop AirSync Protocol",
        2176: "Microsoft ActiveSync RemoteAPI",
        2177: "qWAVE Bandwidth Estimate",
        2180: "Millicent Vendor Gateway Server",
        2181: "Zope Application Server",
        2182: "Cableport-ax",
        2183: "Java GUI Management Agent",
        2184: "NVD User",
        2190: "TiVoConnect Beacon",
        2191: "TvBus Messaging",
        2192: "ASDIS software management",
        2196: "Novell eDirectory SSL",
        2197: "SOAP Application Server",
        2198: "OneHome Remote Access",
        2199: "OneHome Secure",
        2200: "ICI",
        2201: "Advanced Training System Program",
        2202: "Int. Multimedia Teleconferencing Cosortium",
        2203: "b2 Runtime Protocol",
        2204: "b2 License Server",
        2205: "Java Presentation Server",
        2206: "HP OpenCall bus",
        2207: "HP Status and Services",
        2208: "HP I/O Backend",
        2209: "HP RIM for Files Portal Service",
        2210: "NOAAPORT Broadcast Network",
        2211: "EMWIN",
        2212: "LeeCO POS Server Service",
        2213: "Kali",
        2220: "NetIQ End2End",
        2221: "ESET Anti-virus updates",
        2222: "DirectAdmin",
        2223: "DirectAdmin",
        2232: "IVS Video default",
        2233: "INFOCRYPT",
        2234: "DirectPlay",
        2235: "Sercomm-WLink",
        2236: "Nani",
        2237: "Optech Port1 License Manager",
        2238: "AVIVA SNA Server",
        2239: "Image Query",
        2240: "RECIPe",
        2241: "IVS Daemon",
        2242: "Folio Remote Server",
        2243: "Magicom Protocol",
        2244: "NMS Server",
        2245: "HaO",
        2246: "PacketCable MTA Addr Map",
        2247: "Antidote Deployment Manager Service",
        2248: "User Management Service",
        2249: "RISO File Manager Protocol",
        2250: "remote-collab",
        2251: "Distributed Framework Port",
        2252: "NJENET using SSL",
        2253: "DTV Channel Request",
        2254: "Seismic P.O.C. Port",
        2255: "VRTP - ViRtue Transfer Protocol",
        2256: "PCC MFP",
        2257: "Simple Text Oriented Messaging Protocol",
        2258: "Rotorcraft Communications Test Protocol",
        2260: "APC 2260",
        2261: "CoMotion Master Server",
        2262: "CoMotion Backup Server",
        2263: "ECweb Configuration Service",
        2264: "Audio Precision Apx500 API Port 1",
        2265: "Audio Precision Apx500 API Port 2",
        2266: "M-Files Server",
        2267: "OntoBroker",
        2268: "AMT",
        2269: "MIKEY",
        2270: "Starfish SFM",
        2271: "Secure Meeting Maker Scheduling",
        2272: "Meeting Maker Scheduling",
        2273: "MySQL Instance Manager",
        2274: "PCTTunneller",
        2275: "ibridge-data",
        2276: "ibridge-mgmt",
        2277: "Bt device control proxy",
        2278: "Simple Stacked Sequences Database",
        2279: "xmquery",
        2280: "LNVPOLLER",
        2281: "LNVCONSOLE",
        2282: "LNVALARM",
        2283: "LNVSTATUS",
        2284: "LNVMAPS",
        2285: "LNVMAILMON",
        2286: "NAS-Metering",
        2287: "DNA",
        2288: "NETML",
        2289: "Lookup dict server",
        2290: "Sonus Logging Services",
        2291: "EPSON Advanced Printer Share Protocol",
        2292: "Sonus Element Management Services",
        2293: "Network Platform Debug Manager",
        2294: "Konshus License Manager (FLEX)",
        2295: "Advant License Manager",
        2296: "Theta License Manager (Rainbow)",
        2297: "D2K DataMover 1",
        2298: "D2K DataMover 2",
        2299: "PC Telecommute",
        2300: "CVMMON",
        2301: "Compaq HTTP",
        2302: "Bindery Support",
        2303: "Proxy Gateway",
        2304: "Attachmate UTS",
        2305: "MT ScaleServer",
        2306: "TAPPI BoxNet",
        2307: "pehelp",
        2308: "sdhelp",
        2309: "SD Server",
        2310: "SD Client",
        2311: "Message Service",
        2312: "WANScaler Communication Service",
        2313: "IAPP (Inter Access Point Protocol)",
        2314: "Catalina",
        2315: "Precise Sft.",
        2316: "SENT License Manager",
        2317: "Attachmate G32",
        2318: "Cadence Control",
        2319: "InfoLibria",
        2320: "Siebel NS",
        2321: "RDLAP",
        2322: "ofsd",
        2323: "3d-nfsd",
        2324: "Cosmocall",
        2325: "ANSYS Licensing Interconnect",
        2326: "IDCP",
        2327: "xingcsm",
        2328: "Netrix SFTM",
        2329: "NVD",
        2330: "TSCCHAT",
        2331: "AGENTVIEW",
        2332: "RCC Host",
        2333: "SNAPP",
        2334: "ACE Client Auth",
        2335: "ACE Proxy",
        2336: "Apple UG Control",
        2337: "ideesrv",
        2338: "Norton Lambert",
        2339: "3Com WebView",
        2340: "WRS Registry",
        2341: "XIO Status",
        2342: "Seagate Manage Exec",
        2343: "nati logos",
        2344: "fcmsys",
        2345: "dbm",
        2346: "Game Connection Port",
        2347: "Game Announcement and Location",
        2348: "Information to query for game status",
        2349: "Diagnostics Port",
        2350: "psbserver",
        2351: "psrserver",
        2352: "pslserver",
        2353: "pspserver",
        2354: "psprserver",
        2355: "psdbserver",
        2356: "GXT License Managemant",
        2357: "UniHub Server",
        2358: "Futrix",
        2359: "FlukeServer",
        2360: "NexstorIndLtd",
        2361: "TL1",
        2362: "digiman",
        2363: "Media Central NFSD",
        2364: "OI-2000",
        2365: "dbref",
        2366: "qip-login",
        2367: "Service Control",
        2368: "OpenTable",
        2370: "L3-HBMon",
        2371: "Compaq World Wire Port",
        2372: "LAN Messenger",
        2373: "Remograph License Manager",
        2374: "Hydra RPC",
        2375: "Docker REST API (plain)",
        2376: "Docker REST API (ssl)",
        2379: "etcd server client API (v2)",
        2380: "etcd server client API (v3)",
        2381: "Compaq HTTPS",
        2382: "Microsoft OLAP",
        2383: "Microsoft OLAP",
        2384: "SDT License Manager",
        2385: "SDT License Manager",
        2386: "Virtual Tape",
        2387: "VSAM Redirector",
        2388: "MYNAH AutoStart",
        2389: "OpenView Session Mgr",
        2390: "RSMTP",
        2391: "3COM Net Management",
        2392: "Tactical Auth",
        2393: "MS OLAP 1",
        2394: "MS OLAP 2",
        2395: "LAN900 Remote",
        2396: "Wusage",
        2397: "NCL",
        2398: "Orbiter",
        2399: "FileMaker, Inc. - Data Access Layer",
        2400: "OpEquus Server",
        2401: "cvspserver",
        2402: "TaskMaster 2000 Server",
        2403: "TaskMaster 2000 Web",
        2404: "IEC 60870-5-104 process control",
        2405: "TRC Netpoll",
        2406: "JediServer",
        2407: "Orion",
        2408: "OptimaNet",
        2409: "SNS Protocol",
        2410: "VRTS Registry",
        2411: "Netwave AP Management",
        2412: "CDN",
        2413: "orion-rmi-reg",
        2414: "Beeyond",
        2415: "Codima Remote Transaction Protocol",
        2416: "RMT Server",
        2417: "Composit Server",
        2418: "cas",
        2419: "Attachmate S2S",
        2420: "DSL Remote Management",
        2421: "G-Talk",
        2422: "CRMSBITS",
        2423: "RNRP",
        2424: "KOFAX-SVR",
        2425: "Fujitsu App Manager",
        2426: "General Electric Remote Server",
        2427: "Media Gateway Control Protocol Gateway",
        2428: "One Way Trip Time",
        2429: "FT-ROLE",
        2430: "venus",
        2431: "venus-se",
        2432: "codasrv",
        2433: "codasrv-se",
        2434: "pxc-epmap",
        2435: "OptiLogic",
        2436: "TOP/X",
        2437: "UniControl",
        2438: "MSP",
        2439: "SybaseDBSynch",
        2440: "Spearway Lockers",
        2441: "Pervasive I*net Data Server",
        2442: "Netangel",
        2443: "PowerClient Central Storage Facility",
        2444: "BT PP2 Sectrans",
        2445: "DTN1",
        2446: "bues_service",
        2447: "OpenView NNM daemon",
        2448: "hpppsvr",
        2449: "RATL",
        2450: "netadmin",
        2451: "netchat",
        2452: "SnifferClient",
        2453: "madge ltd",
        2454: "IndX-DDS",
        2455: "WAGO-IO-SYSTEM",
        2456: "altav-remmgt",
        2457: "Rapido_IP",
        2458: "griffin",
        2459: "Community",
        2460: "ms-theater",
        2461: "qadmifoper",
        2462: "qadmifevent",
        2463: "LSI RAID Management",
        2464: "DirecPC SI",
        2465: "Load Balance Management",
        2466: "Load Balance Forwarding",
        2467: "High Criteria",
        2468: "qip_msgd",
        2469: "MTI-TCS-COMM",
        2470: "taskman port",
        2471: "SeaODBC",
        2472: "C3",
        2473: "Aker-cdp",
        2474: "Vital Analysis",
        2475: "ACE Server",
        2476: "ACE Server Propagation",
        2477: "SecurSight Certificate Valifation Service",
    }

    # check if port is in the dict
    if port in common_ports:
        return common_ports[port]
    else:
        return "Unknown"


def check_vulnerability(port, ip_address):
    try:
        nmap_command = f"nmap --script vuln -p {port} {ip_address}"
        result = subprocess.run(
            nmap_command, shell=True, capture_output=True, text=True
        )
        if "VULNERABLE" in result.stdout:
            return True
    except Exception as e:
        print(f"Error checking vulnerability for port {port}: {e}")
    return False
